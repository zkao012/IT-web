{% extends 'base.html' %}
{% block title %}Sessions â€” TrackIt{% endblock %}
{% block page_title %}My Sessions{% endblock %}

{% block content %}

<!-- ç­›é€‰æ ‡ç­¾ -->
<div class="filter-tabs">
  <a href="{% url 'session_list' %}" class="filter-tab {% if not status_filter %}active{% endif %}">All</a>
  <a href="?status=pending" class="filter-tab {% if status_filter == 'pending' %}active{% endif %}">â³ Pending</a>
  <a href="?status=in_progress" class="filter-tab {% if status_filter == 'in_progress' %}active{% endif %}">ğŸ”µ In Progress</a>
  <a href="?status=completed" class="filter-tab {% if status_filter == 'completed' %}active{% endif %}">âœ… Completed</a>
  <a href="?status=cancelled" class="filter-tab {% if status_filter == 'cancelled' %}active{% endif %}">â¬œ Cancelled</a>
</div>

<!-- Session åˆ—è¡¨ -->
{% for session in sessions %}
<div class="trackit-card mb-3" style="display:flex; flex-direction:row;">
  <div class="card-accent
    {% if session.status == 'completed' %}accent-success
    {% elif session.status == 'in_progress' %}accent-primary
    {% elif session.status == 'cancelled' %}accent-secondary
    {% else %}accent-warning{% endif %}">
  </div>
  <div style="padding: 20px 24px; flex:1;">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px;">
      <div>
        <h5 style="font-size:16px; font-weight:700; margin-bottom:4px;">{{ session.task.title }}</h5>
        <div style="font-size:13px; color:var(--gray-400);">
          <i class="fas fa-clock" style="margin-right:4px;"></i>
          {{ session.planned_start|date:"M d, Y Â· H:i" }} â†’ {{ session.planned_end|date:"H:i" }}
        </div>
      </div>
      <span class="status-badge status-{{ session.status }}">
        {{ session.get_status_display }}
      </span>
    </div>

    <!-- æ—¶é—´è¿›åº¦ -->
    <div class="progress-track">
      <div class="progress-fill" style="width:{{ session.completion_percent }}%"></div>
    </div>
    <div style="font-size:12px; color:var(--gray-400); margin-bottom:4px;">
      â­ Learning Quality: {{ session.completion_percent }}% Â· â± {{ session.actual_minutes }} min logged
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div style="display:flex; gap:8px; margin-top:12px;">
      <a href="{% url 'session_detail' session.pk %}" class="btn-outline-primary-custom">
        <i class="fas fa-edit"></i> Update Progress
      </a>
      {% if session.status != 'cancelled' and session.status != 'completed' %}
      <form method="post" action="{% url 'session_cancel' session.pk %}"
            onsubmit="return confirm('Cancel this session?')" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn-outline-danger-custom">
          <i class="fas fa-times"></i> Cancel
        </button>
      </form>
      {% endif %}
      {% if session.status == 'cancelled' %}
      <form method="post" action="{% url 'session_delete' session.pk %}"
            onsubmit="return confirm('Permanently delete this session?')" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn-outline-danger-custom">
          <i class="fas fa-trash"></i> Delete
        </button>
      </form>
      {% endif %}
    </div>
  </div>
</div>

{% empty %}
<div class="empty-state">
  <i class="fas fa-calendar-plus"></i>
  <p>No sessions yet. Book your first one!</p>
  <a href="{% url 'session_book' %}" class="btn-orange">+ Book a Session</a>
</div>
{% endfor %}

{% endblock %}